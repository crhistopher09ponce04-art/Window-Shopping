{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>🧰 {{ t("Servicios disponibles", "Available services", "可用服务") }}</h2>
  <form method="get" class="mt-2">
    <label>{{ t("Buscar", "Search", "搜索") }}</label>
    <input type="text" name="q" value="{{ q or '' }}" placeholder="{{ t('servicio, empresa, ubicación...','service, company, location...','服务、公司、位置...') }}">
    <button class="btn" type="submit">{{ t("Filtrar", "Filter", "筛选") }}</button>
  </form>
</div>

{% if data and data|length>0 %}
  <div class="grid mt-2">
    {% for c in data %}
      <div class="card">
        <h3><a href="{{ url_for('empresa', slug=c.slug) }}">{{ c.nombre }}</a></h3>
        <p class="mt-1">
          <span class="badge">{{ c.rol }}</span> • {{ c.pais }} • RUT: {{ c.rut }}
        </p>
        <p class="mt-1">{{ c.breve }}</p>

        {% if c.items and c.items|length>0 %}
          <table class="table mt-2">
            <thead>
              <tr>
                <th>{{ t("Servicio", "Service", "服务") }}</th>
                <th>{{ t("Capacidad", "Capacity", "产能") }}</th>
                <th>{{ t("Ubicación", "Location", "位置") }}</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            {% for it in c.items %}
              <tr>
                <td>{{ it.servicio }}</td>
                <td>{{ it.capacidad }}</td>
                <td>{{ it.ubicacion }}</td>
                <td class="right">
                  <form method="POST" action="{{ url_for('cart_add') }}">
                    <input type="hidden" name="empresa" value="{{ c.nombre }}">
                    <input type="hidden" name="servicio" value="{{ it.servicio }}">
                    <input type="hidden" name="tipo" value="servicio">
                    <button type="submit" class="btn">{{ t("Agregar", "Add", "加入") }}</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <div class="mt-2">
          <a class="btn btn-secondary" href="{{ url_for('empresa', slug=c.slug) }}">{{ t("Ver perfil", "View profile", "查看资料") }}</a>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card mt-2"><p>{{ t("No hay registros disponibles.", "No records available.", "暂无记录。") }}</p></div>
{% endif %}

<a href="{{ url_for('dashboard') }}" class="btn mt-3">⬅️ {{ t("Volver", "Back", "返回") }}</a>
{% endblock %}

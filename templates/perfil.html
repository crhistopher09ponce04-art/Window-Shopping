{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>ğŸ‘¤ {{ t("Mi Perfil", "My Profile", "å€‹äººè³‡æ–™") }}</h2>
  {% if mensaje %}<div class="flash mt-2">{{ mensaje }}</div>{% endif %}
  <form method="POST" class="mt-2">
    <input type="hidden" name="action" value="save_profile">
    <div class="grid-3">
      <div>
        <label>{{ t("Nombre empresa", "Company name", "å…¬å¸åç¨±") }}</label>
        <input type="text" name="empresa" value="{{ perfil.empresa }}">
      </div>
      <div>
        <label>RUT</label>
        <input type="text" name="rut" value="{{ perfil.rut }}">
      </div>
      <div>
        <label>Email</label>
        <input type="email" name="email" value="{{ perfil.email }}">
      </div>
    </div>
    <div class="grid-3">
      <div>
        <label>{{ t("TelÃ©fono", "Phone", "é›»è©±") }}</label>
        <input type="text" name="telefono" value="{{ perfil.telefono }}">
      </div>
      <div>
        <label>{{ t("DirecciÃ³n", "Address", "åœ°å€") }}</label>
        <input type="text" name="direccion" value="{{ perfil.direccion }}">
      </div>
      <div>
        <label>{{ t("Rol", "Role", "è§’è‰²") }}</label>
        <input type="text" value="{{ perfil.rol }}" disabled>
      </div>
    </div>

    <label>{{ t("DescripciÃ³n", "Description", "æè¿°") }}</label>
    <textarea name="descripcion" rows="3">{{ perfil.descripcion }}</textarea>

    <input type="submit" class="mt-2" value="{{ t('Guardar', 'Save', 'å„²å­˜') }}">
  </form>
</div>

<div class="grid">
  <div class="card">
    {% if perfil.perfil_tipo=='servicios' %}
      <h3>â• {{ t("Agregar servicio", "Add service", "æ–°å¢æœå‹™") }}</h3>
      <form method="POST" class="mt-2">
        <input type="hidden" name="action" value="add_item">
        <div class="grid-3">
          <div>
            <label>{{ t("Servicio", "Service", "æœå‹™") }}</label>
            <input type="text" name="servicio" placeholder="Almacenaje en frÃ­o">
          </div>
          <div>
            <label>{{ t("Capacidad", "Capacity", "å®¹é‡") }}</label>
            <input type="text" name="capacidad" placeholder="1.000 pallets">
          </div>
          <div>
            <label>{{ t("UbicaciÃ³n", "Location", "ä½ç½®") }}</label>
            <input type="text" name="ubicacion" placeholder="ValparaÃ­so">
          </div>
        </div>
        <input type="submit" value="{{ t('Agregar', 'Add', 'æ–°å¢') }}">
      </form>
    {% else %}
      <h3>â• {{ t("Agregar oferta/demanda", "Add offer/demand", "æ–°å¢ä¾›çµ¦/éœ€æ±‚") }}</h3>
      <form method="POST" class="mt-2">
        <input type="hidden" name="action" value="add_item">
        <div class="grid-4">
          <div>
            <label>{{ t("Tipo", "Type", "é¡å‹") }}</label>
            <select name="subtipo">
              <option value="oferta">{{ t("Oferta", "Offer", "ä¾›çµ¦") }}</option>
              <option value="demanda">{{ t("Demanda", "Demand", "éœ€æ±‚") }}</option>
            </select>
          </div>
          <div>
            <label>{{ t("Producto", "Product", "ç”¢å“") }}</label>
            <input type="text" name="producto" placeholder="Uva, cereza, etc.">
          </div>
          <div>
            <label>{{ t("Variedad", "Variety", "å“ç¨®") }}</label>
            <input type="text" name="variedad" placeholder="Crimson, Santina...">
          </div>
          <div>
            <label>{{ t("Calibre", "Size", "è¦æ ¼") }}</label>
            <input type="text" name="calibre" placeholder="28+, L, etc.">
          </div>
        </div>
        <div class="grid-3">
          <div>
            <label>{{ t("Cantidad", "Quantity", "æ•¸é‡") }}</label>
            <input type="text" name="cantidad" placeholder="100 pallets">
          </div>
          <div>
            <label>{{ t("Origen", "Origin", "ç”¢åœ°") }}</label>
            <input type="text" name="origen" placeholder="VI RegiÃ³n">
          </div>
          <div>
            <label>{{ t("Precio", "Price", "åƒ¹æ ¼") }}</label>
            <input type="text" name="precio" placeholder="{{ t('A convenir', 'To agree', 'å¦è­°') }}">
          </div>
        </div>
        <input type="submit" value="{{ t('Agregar', 'Add', 'æ–°å¢') }}">
      </form>
    {% endif %}
  </div>

  <div class="card">
    <h3>{{ t("Mis Ã­tems", "My items", "æˆ‘çš„é …ç›®") }}</h3>
    {% if perfil.items and perfil.items|length>0 %}
      <table class="table mt-2" id="mis-items">
        <thead>
        <tr>
          {% if perfil.perfil_tipo=='servicios' %}
            <th>{{ t("Servicio", "Service", "æœå‹™") }}</th>
            <th>{{ t("Capacidad", "Capacity", "å®¹é‡") }}</th>
            <th>{{ t("UbicaciÃ³n", "Location", "ä½ç½®") }}</th>
            <th>{{ t("Eliminar (vista)", "Remove (view)", "åˆªé™¤(è¦–åœ–)") }}</th>
          {% else %}
            <th>{{ t("Tipo", "Type", "é¡å‹") }}</th>
            <th>{{ t("Producto", "Product", "ç”¢å“") }}</th>
            <th>{{ t("Variedad", "Variety", "å“ç¨®") }}</th>
            <th>{{ t("Calibre", "Size", "è¦æ ¼") }}</th>
            <th>{{ t("Cantidad", "Quantity", "æ•¸é‡") }}</th>
            <th>{{ t("Origen", "Origin", "ç”¢åœ°") }}</th>
            <th>{{ t("Precio", "Price", "åƒ¹æ ¼") }}</th>
            <th>{{ t("Eliminar (vista)", "Remove (view)", "åˆªé™¤(è¦–åœ–)") }}</th>
          {% endif %}
        </tr>
        </thead>
        <tbody>
        {% for it in perfil.items %}
          <tr>
            {% if perfil.perfil_tipo=='servicios' %}
              <td>{{ it.servicio }}</td>
              <td>{{ it.capacidad }}</td>
              <td>{{ it.ubicacion }}</td>
              <td><button class="btn btn-secondary" type="button" onclick="this.closest('tr').remove();">{{ t('Eliminar','Remove','åˆªé™¤') }}</button></td>
            {% else %}
              <td>{{ it.tipo }}</td>
              <td>{{ it.producto }}</td>
              <td>{{ it.variedad or '-' }}</td>
              <td>{{ it.calibre or '-' }}</td>
              <td>{{ it.cantidad }}</td>
              <td>{{ it.origen }}</td>
              <td>{{ it.precio or '-' }}</td>
              <td><button class="btn btn-secondary" type="button" onclick="this.closest('tr').remove();">{{ t('Eliminar','Remove','åˆªé™¤') }}</button></td>
            {% endif %}
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <p class="mt-1" style="opacity:.8;">{{ t("Nota: esta eliminaciÃ³n es solo visual; al recargar, los Ã­tems reaparecen.",
                                                 "Note: this removal is only visual; items reappear on refresh.",
                                                 "æ³¨æ„ï¼šæ­¤åˆªé™¤åƒ…ç‚ºè¦–è¦ºæ•ˆæœï¼Œé‡æ–°æ•´ç†å¾Œæœƒæ¢å¾©ã€‚") }}</p>
    {% else %}
      <p class="mt-1">{{ t("AÃºn no has agregado Ã­tems.", "You haven't added items yet.", "å°šæœªæ–°å¢ä»»ä½•é …ç›®") }}</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% extends "base.html" %}
{% block content %}
<div class="panel">
  {% set title = {'ventas': t('Ofertas de venta','Sales offers','é”€å”®æŠ¥ä»·'),
                  'compras': t('Demandas de compra','Purchase demands','é‡‡è´­éœ€æ±‚'),
                  'servicios': t('Servicios disponibles','Available services','å¯ç”¨æœåŠ¡')} %}
  <h3 style="margin:0 0 10px 0;">{{ title[tipo] }}</h3>

  <form class="searchbar" method="get">
    <input type="text" name="q" value="{{ q or '' }}" placeholder="{{ t('Buscar por producto, empresa, ubicaciÃ³nâ€¦','Search by item, company, locationâ€¦','æŒ‰å“é¡¹ã€å…¬å¸æˆ–åœ°ç‚¹æœç´¢â€¦') }}">
    <button class="btn btn-outline">ğŸ” {{ t('Buscar','Search','æœç´¢') }}</button>
  </form>

  {% if data %}
    <div class="grid grid-4">
      {% for it in data %}
      <div class="tile">
        <div class="badge">{{ it.id }}</div>
        <h4 style="margin:10px 0 4px 0;">{{ it.item }}</h4>
        <div class="meta">{{ it.company }} â€” {{ it.location }}</div>
        <div class="price">{{ it.price }}</div>
        <div class="meta mt-1">{{ it.qty }} â€¢ {{ it.spec }}</div>

        <div class="mt-2">
          <button class="btn btn-green me-1" onclick="addToCart('{{ tipo }}','{{ it.id }}')">ğŸ›’ {{ t('Agregar','Add','åŠ å…¥') }}</button>
          <button class="btn btn-red btn-outline" onclick="hideItem('{{ tipo }}','{{ it.id }}')">âœ– {{ t('Ocultar','Hide','éšè—') }}</button>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="flash alert-warn">{{ t("No hay registros disponibles.","No records available.","æš‚æ— è®°å½•") }}</div>
  {% endif %}

  <div class="mt-3">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">â¬…ï¸ {{ t("Volver","Back","è¿”å›") }}</a>
  </div>
</div>

<script>
async function addToCart(tipo,id){
  await fetch(`{{ url_for('cart_add', tipo='__t__', item_id='__i__') }}`.replace('__t__',tipo).replace('__i__',id),{method:'POST'});
  alert("{{ t('Agregado al carrito','Added to cart','å·²åŠ å…¥è´­ç‰©è½¦') }}");
}
async function hideItem(tipo,id){
  await fetch(`{{ url_for('hide_item', tipo='__t__', item_id='__i__') }}`.replace('__t__',tipo).replace('__i__',id),{method:'POST'});
  location.reload();
}
</script>
{% endblock %}

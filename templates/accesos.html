{% extends "base.html" %}
{% block content %}
<h2>Opciones de {{ tipo|capitalize }} (Rol: {{ rol }}) — {{ _("rubro") }}: {{ rubro }}</h2>

<form method="get" class="filters card">
  <div class="row">
    <div>
      <label>{{ _("rubro") }}</label>
      <select name="rubro">
        <option value="fruta" {{ 'selected' if rubro=='fruta' else '' }}>{{ _("fruit") }}</option>
        <option value="servicio" {{ 'selected' if rubro=='servicio' else '' }}>{{ _("service") }}</option>
      </select>
    </div>
    <div>
      <label>{{ _("type") }}</label>
      <select name="tipo_item">
        <option value="">{{ "--" }}</option>
        <option value="venta" {{ 'selected' if values.tipo_item=='venta' else '' }}>{{ _("sale") }}</option>
        <option value="compra" {{ 'selected' if values.tipo_item=='compra' else '' }}>{{ _("buying") }}</option>
      </select>
    </div>
    <div>
      <label>{{ _("search") }}</label>
      <input type="text" name="q" value="{{ values.q }}" placeholder="Empresa, ciudad, producto...">
    </div>
    <div>
      <label>{{ _("role") }}</label>
      <select name="role">
        <option value="">--</option>
        {% for r in roles_opts %}
          <option value="{{ r }}" {{ 'selected' if values.role==r else '' }}>{{ r }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>{{ _("country") }}</label>
      <input type="text" name="country" value="{{ values.country }}">
    </div>
    <div>
      <label>{{ _("city") }}</label>
      <input type="text" name="city" value="{{ values.city }}">
    </div>
  </div>
  <div class="row">
    <div style="align-self:flex-end;">
      <button type="submit" class="btn">{{ _("apply_filters") }}</button>
    </div>
    <div style="align-self:flex-end;">
      <a class="btn ghost" href="{{ url_for('accesos', tipo=tipo) }}">{{ _("clear") }}</a>
    </div>
  </div>
</form>

{% if filas %}
  <table class="table">
    <thead>
      <tr>
        <th>{{ _("name") }}</th>
        <th>{{ _("role") }}</th>
        <th>{{ _("rubro") }}</th>
        <th>{{ _("type") }}</th>
        <th>{{ _("product") }}</th>
        <th>{{ _("variety") }}</th>
        <th>{{ _("quantity") }}</th>
        <th>{{ _("price") }}</th>
        <th>{{ _("email") }}</th>
      </tr>
    </thead>
    <tbody>
      {% for f in filas %}
      <tr>
        <td><a href="{{ url_for('detalle', company_id=f.company.id) }}">{{ f.company.name }}</a></td>
        <td>{{ f.company.role }}</td>
        <td>{{ f.item.rubro }}</td>
        <td>{{ f.item.type }}</td>
        <td>{{ f.item.product }}</td>
        <td>{{ f.item.variety }}</td>
        <td>{{ f.item.quantity }} {{ _("units." + f.item.unit) }}</td>
        <td>{{ f.item.price or '-' }}</td>
        <td>{{ f.company.email }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>{{ _("empty_list") }}</p>
{% endif %}

<p style="margin-top:14px;"><a href="{{ url_for('dashboard') }}">⬅ {{ _("back") }}</a></p>
{% endblock %}
